include(SwiftUtils)
include(SwiftWindowsSupport)

add_swift_host_tool(swift-config
  swift-config.cpp
  LINK_LIBRARIES
    swiftFrontend
  SWIFT_COMPONENT tools
  LLVM_COMPONENT_DEPENDS support
)

set(SWIFT_PREFIX_DIR ${CMAKE_BINARY_DIR})
set(CMAKE_INSTALL_PREFIX ${CMAKE_INSTALL_PREFIX})
set(SWIFT_OBJ_DIR ${SWIFT_BINARY_DIR})

set(SWIFT_BIN_DIR ${SWIFT_RUNTIME_OUTPUT_INTDIR})
string(REPLACE "/./" "/" SWIFT_BIN_DIR "${SWIFT_BIN_DIR}")

set(SWIFTLIB_DIR "${CMAKE_BINARY_DIR}/${CMAKE_CFG_INTDIR}/lib/swift")
string(REPLACE "/./" "/" SWIFTLIB_DIR "${SWIFTLIB_DIR}")

set(SWIFTSTATICLIB_DIR "${CMAKE_BINARY_DIR}/${CMAKE_CFG_INTDIR}/lib/swift_static")
string(REPLACE "/./" "/" SWIFTSTATICLIB_DIR "${SWIFTSTATICLIB_DIR}")

set(SWIFT_INCLUDE_DIRS ${SWIFT_MAIN_INCLUDE_DIR} ${SWIFT_INCLUDE_DIR})
string(STRIP "${SWIFT_INCLUDE_DIRS}" SWIFT_INCLUDE_DIRS)

set(SWIFT_LIBRARY_DIR ${SWIFT_LIBRARY_OUTPUT_INTDIR})
string(REPLACE "/./" "/" SWIFT_LIBRARY_DIR "${SWIFT_LIBRARY_DIR}")

set(SWIFT_LIBRARY_DIRS ${SWIFT_LIBRARY_OUTPUT_INTDIR} ${SWIFT_CONFIG_LIBRARY_DIRS})
string(STRIP "${SWIFT_LIBRARY_DIRS}" SWIFT_LIBRARY_DIRS)
string(REPLACE "/./" "/" SWIFT_LIBRARY_DIRS "${SWIFT_LIBRARY_DIRS}")

set(SWIFT_CPPFLAGS "${CMAKE_CPP_FLAGS} ${CMAKE_CPP_FLAGS_${uppercase_CMAKE_BUILD_TYPE}}")
string(STRIP "${SWIFT_CPPFLAGS}" SWIFT_CPPFLAGS)

set(SWIFT_CFLAGS "${CMAKE_C_FLAGS} ${CMAKE_C_FLAGS_${uppercase_CMAKE_BUILD_TYPE}}")
string(STRIP "${SWIFT_CFLAGS}" SWIFT_CFLAGS)

set(SWIFT_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${CMAKE_CXX_FLAGS${uppercase_CMAKE_BUILD_TYPE}}")
string(STRIP "${SWIFT_CXX_FLAGS}" SWIFT_CXX_FLAGS)

if("${CMAKE_SYSTEM_NAME}" STREQUAL "Windows")
  string(REPLACE "/" "\\" SWIFTLIB_DIR "${SWIFTLIB_DIR}")
  string(REPLACE "/" "\\" SWIFTSTATICLIB_DIR "${SWIFTSTATICLIB_DIR}")
endif()

configure_file(
  BuildVariables.inc.in
  BuildVariables.inc
  @ONLY
)
